{% extends theme('layouts/_survey.html') -%}

{% block page_title -%}Summary{% endblock -%}

{% set not_answered = 'No answer provided' %}

{% block main -%}
<div class="header u-ta-l">
  <h1 class="header__title saturn">Your responses</h1>
  <h2 class="header__subtitle mars">Please check carefully before submission.</h2>
</div>

<div>
  <div class="summary">
  {% for block in content %}

    {% set outer_loop_index = loop.index0 %}

    {% set summary_id = "summary-" ~ outer_loop_index %}

    <h2 class="summary__title saturn" id="{{summary_id}}">{{block.title|safe}}</h2>
    <div class="summary__block">
      <div class="summary__items">

      {% for item in block.items %}

        {% set inner_loop_index = loop.index0 %}

        {% set id = summary_id ~ "-" ~ inner_loop_index %}

        <div class="summary__question" id="{{id}}">
          {{item.question|safe}}
        </div>

        {% for sub_item in item.sub_items %}

          {% if item.sub_items|length > 1 %}
            <div class="summary__question summary__question--sub">
              {{sub_item.answer_title|safe}}
            </div>
          {% endif %}

          <div class="summary__answer">
            {% set item_id = id ~ "-" ~ loop.index0 %}
            <div class="summary__answer-text" id="{{item_id}}-answer" data-qa="answer-{{outer_loop_index}}-{{inner_loop_index}} answer-type-{{item.type}}">
              {%- if sub_item.answer is none -%}
                {{not_answered}}
              {%- else -%}
                {% include theme(['partials/summary/' ~ sub_item.type ~ '.html', 'partials/summary/default.html']) %}
              {%- endif -%}
            </div>
            <div class="summary__edit">
              <a href="{{sub_item.link}}" class="summary__edit-link" aria-describedby="{{item_id}} {{item_id}}-answer" data-qa="edit-{{item.type}}">Edit <span class="u-vh">your answer</span></a>
            </div>
          </div>

        {% endfor %}

      {% endfor %}

      </div>
    </div>
  {% endfor %}
  </div>

  <form action="" method="POST" novalidate>
    <button class="btn btn--secondary u-mr-s qa-btn-submit-answers venus" type="submit" name="action[submit_answers]">Submit answers</button>
  </form>
</div>

{% endblock -%}
