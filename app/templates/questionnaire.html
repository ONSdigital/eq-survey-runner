{% extends theme('layouts/_survey.html') %}

{% block page_title %}Survey{% endblock %}

{% block main %}

<div class="grid">
  <div class="grid__col col-8@m">
    {% if schema.navigation %}
    {% for group in navigation %}
      {% if group.repeating %}&emsp;{% endif %}
      {% if group.current_location %}
        {{group.link_name}}
      {% else %}
        <a href="../../{{group.path}}">{{group.link_name}}</a>
      {% endif %}

      {% if group.completed %}
        completed
      {% endif %}
     <br/>
     {% endfor %}
      {% endif %}
    <br/>
    {% set state = content %}

    {% set all_errors = state.get_errors().items() %}

    {% if all_errors %}

      <div class="u-mb-s">
        <div class="alert alert--error">
          <div class="alert__header">
            <h1 class="alert__title venus">This page has {{all_errors|length}} errors</h1>
          </div>
          <div class="alert__body">
            <p class="mars">These <strong>must be corrected</strong> to continue.</p>
            <ul class="list list--bare">
              {% for item_id, errors in all_errors %}
                {% set loop_index = loop.index %}
                {% if errors %}
                {% for error in errors %}
                <li class="list__item mars">
                  {{loop_index}}) <a class="js-inpagelink" href="#{{item_id}}">{{ error }}</a>
                </li>
                {% endfor %}
                {% endif %}
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>

    {% endif %}

    <form action="" class="form qa-questionnaire-form" role="form" method="POST" novalidate>

        {% set group = state.schema_item.container %}

        {% set block = state.schema_item %}

        {% set first_block = group['blocks'][0]['id'] != block['id'] %}

        {% if first_block %}
            <div class="u-mb-s">
                <a id="top-previous" class="mars" href="{{previous_location}}">Previous</a>
            </div>
        {% endif %}

          <div class="group" id="{{group.id}}">


            <div class="block" id="{{block.id}}">

            {% for section in state.children %}

              {% include 'partials/section.html' %}

            {% endfor %}

            </div>

          </div>

      <button class="btn btn--primary qa-btn-submit venus" type="submit" name="action[save_continue]">{% block submit_button_text %}Save and continue{% endblock %}</button>
      {% if first_block %}
        <div class="u-mt-xs">
        <a id="bottom-previous" class="mars" href="{{previous_location}}">Previous</a>
      </div>
      {% endif %}
    </form>
  </div>
</div>

{% endblock %}
