{% import 'macros/helpers.html' as helpers %}

{% set invalid = question.is_valid == False %}

{% set question_title = question.schema_item.title %}
{% set question_subtitle = question.schema_item.subtitle %}

{% set question_titles %}
  {%- if question_title -%}
    <h2 class="question__title neptune">{{question_title}}</h2>
  {%- endif %}
  {%- if question_subtitle -%}
    <br />
    <h3 class="question__subtitle mars">{{question_subtitle}}</h3>
  {%- endif %}
{% endset %}

{% set question_description %}
  {%- if question.schema_item.description %}
    <div class="question__description mars" id="description-{{question.id}}">
      {{question.schema_item.description|safe}}
    </div>
  {% endif %}
{% endset %}

{% set question_answers %}
 <div class="question__answers">
   {%- if question.schema_item.type == 'RepeatingAnswer' %}
     {%- for answer in question.answers %}
       <h3>Person {{ loop.index }}
         {% if loop.index > 1 %}
         &nbsp;(<button style="background:none!important; font-weight: normal !important; color: #4263c2; border:none; padding:0!important; font: inherit; cursor: pointer;" href="#" name="action[remove_person]" value="{{ loop.index0 }}">Remove</button>)
         {% endif %}
       </h3>
         {% include theme('partials/answer.html') %}
     {%- endfor %}
   {%- else %}
     {%- for answer in question.answers -%}
       {% include theme('partials/answer.html') %}
     {%- endfor -%}
   {%- endif %}
 </div>
{% endset %}

{% set question_actions %}
<style>
.btn--border--census {
    background-color: #fff;
    color: #6E2585;
    border: none;
    padding: 13px 48px;
    margin: 2em 0 1em 0;
    border-radius: 3px;
    display: inline-block;
    text-rendering: optimizeLegibility;
    text-decoration: none;
    cursor: pointer;
    text-align: center;
    border: 3px solid #6E2585;
    padding: 10px 42px;
}
</style>
<div class="question__actions">
  {%- if question.schema_item.type == 'RepeatingAnswer' %}
  <button class="btn btn--border--census add-entity venus" type="submit" name="action[add_answer]">Add another person</button>
  {%- endif %}
</div>
{% endset %}


<div class="question" id="{{question.id}}">

  {% set question_markup %}

    {% if question.answers|length > 1 %}

      <fieldset class="question__fieldset">

        <legend class="question__legend">
          {%- if question_title -%}
            <span class="question__title neptune">{{question_title}}</span>
          {%- endif %}
          {%- if question_subtitle -%}
            <br />
            <span class="question__subtitle venus">{{question_subtitle}}</span>
          {%- endif %}
        </legend>

        {{question_description|safe}}
        {{question_answers|safe}}

      </fieldset>

    {% else %}

      {{question_titles|safe}}
      {{question_description|safe}}
      {{question_answers|safe}}

    {% endif %}

  {% endset %}

  {% if invalid %}

    <div class="alert alert--simple alert--error">
      <div class="alert__header">
        {% if question.errors %}
        <ul class="list list--bare list--errors">
          {% for error in question.errors %}
            <li class="list__item venus" {{helpers.errorTracking(question.id, error)}}>{{ error }}</li>
          {% endfor %}
        </ul>
        {% endif %}
      </div>
      <div class="alert__body">
        {{question_markup|safe}}
      </div>
    </div>

  {% else %}

    {{question_markup|safe}}

    {{question_actions|safe}}

  {% endif %}

</div>
