{% import 'macros/helpers.html' as helpers %}

{% set invalid = question.is_valid == False %}

{% set question_title = question.schema_item.title %}
{% set question_subtitle = question.schema_item.subtitle %}

{% set question_titles %}
  {%- if question.schema_item.title -%}
    <h3 class="question__title neptune">{{question.schema_item.title}}</h3>
  {%- endif %}
  {%- if question.schema_item.subtitle -%}
    <h4 class="question__subtitle mars">{{question.schema_item.subtitle}}</h4>
  {%- endif %}
{% endset %}

{% set question_description %}
  {%- if question.schema_item.description%}
    <div class="question__description mars" id="description-{{question.id}}">
      {{question.schema_item.description|safe}}
    </div>
  {% endif %}
{% endset %}

{% set question_answers %}
  <div class="question__answers">
    {%- for answer in question.answers -%}
      {% include theme('partials/answer.html') %}
    {%- endfor -%}
  </div>
{% endset %}

<div class="question" id="{{question.id}}">

  {% set question_markup %}

    {% if question.answers|length > 1 %}

      <fieldset class="question__fieldset">

        <legend class="question__legend">
          {{question_titles|safe}}
        </legend>

        {{question_description|safe}}
        {{question_answers|safe}}

      </fieldset>

    {% else %}

      {{question_titles|safe}}
      {{question_description|safe}}
      {{question_answers|safe}}

    {% endif %}

  {% endset %}

  {% if invalid %}

    <div class="alert alert--simple alert--error">
      <div class="alert__header">
        {% if question.errors %}
        <ul class="list list--bare list--errors">
          {% for error in question.errors %}
            <li class="list__item venus" {{helpers.errorTracking(question.id, error)}}>{{ error }}</li>
          {% endfor %}
        </ul>
        {% endif %}
      </div>
      <div class="alert__body">
        {{question_markup|safe}}
      </div>
    </div>

  {% else %}

    {{question_markup|safe}}

  {% endif %}

</div>
