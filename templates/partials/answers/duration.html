{% from "components/mutually-exclusive/_macro.njk" import onsMutuallyExclusive %}
{% from "components/fieldset/_macro.njk" import onsFieldset %}
{% from "components/field/_macro.njk" import onsField %}
{% from "components/input/_macro.njk" import onsInput %}

{%- set numberOfFields = 0 -%}

{%- if form.fields[answer.id].years -%}
  {%- set numberOfFields = numberOfFields + 1 -%}
{%- endif -%}

{%- if form.fields[answer.id].months -%}
  {%- set numberOfFields = numberOfFields + 1 -%}
{%- endif -%}

{%- set fields -%}

    {% if answer.label %}
      <span class="u-fs-r--b u-mb-xs u-d-b">{{ answer.label }}</span>
    {% endif %}

    {%- if form.fields[answer.id].years -%}
      {% set input = form.fields[answer.id].years %}
        {{ onsInput({
          "id": input.id,
          "classes": "input--w-2" + (" js-exclusive-group" if mutuallyExclusive else ""),
          "name": input.name,
          "value": input.data if input.data is not none else '',
          "suffix": {
            "title": _(input.label.text),
            "text": format_unit_input_label('duration-year', unit_length='long') | capitalize
          },
          "dontWrap": numberOfFields < 2
        }) }}
    {%- endif -%}

    {%- if form.fields[answer.id].months -%}
      {% set input = form.fields[answer.id].months %}
        {{ onsInput({
          "id": input.id,
          "classes": "input--w-2" + (" js-exclusive-group" if mutuallyExclusive else ""),
          "name": input.name,
          "value": input.data if input.data is not none else '',
          "suffix": {
            "title": _(input.label.text),
            "text": format_unit_input_label('duration-month', unit_length='long') | capitalize
          },
          "dontWrap": numberOfFields < 2
        }) }}
    {%- endif -%}

{%- endset -%}

{%- if mutuallyExclusive -%}
  {% set mutuallyExclusive = mutuallyExclusive | setAttributes({
    "legend": question_title,
    "legendClasses": "u-vh"
  }) -%}

  {%- call onsMutuallyExclusive(mutuallyExclusive) -%}
    <div class="field-group">
      {{- fields | safe -}}
    </div>
  {%- endcall -%}
{%- elif numberOfFields > 1 -%}
  {%- call onsFieldset({
    "id": answer.id,
    "legend": question_title,
    "legendClasses": "u-vh"
  }) %}
    <div class="field-group">
      {{- fields | safe -}}
    </div>
  {%- endcall -%}
{%- else -%}
  {%- call onsField({
    "id": answer.id
  }) -%}
    {{- fields | safe -}}
  {%- endcall -%}
{%- endif -%}
